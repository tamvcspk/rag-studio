<div class="security-settings-panel">
  @if (settingsStore.error()) {
    <rag-alert variant="error" [icon]="'alert-circle'">
      {{ settingsStore.error() }}
    </rag-alert>
  }

  <!-- Security Status Alert -->
  <rag-alert
    [variant]="securityStatusVariant()"
    [icon]="securityStatusIcon()">
    {{ securityStatusMessage() }}
  </rag-alert>

  <form [formGroup]="settingsForm" (ngSubmit)="saveSettings()" class="settings-form">

    <!-- Network Security Section -->
    <rag-settings-section
      title="Network Security"
      description="Configure network access and air-gapped mode settings"
      [icon]="NetworkIcon">

      <div class="security-status" slot="header-actions">
        Mode: {{ networkMode() }}
      </div>

      <div class="form-grid">
        <rag-form-field label="Air-gapped Mode">
          <rag-checkbox formControlName="airGappedMode">
            Enable air-gapped mode (blocks all outbound connections)
          </rag-checkbox>
        </rag-form-field>

        @if (!settingsForm.value.airGappedMode) {
          <rag-form-field label="Network Policy">
            <select
              formControlName="networkPolicy"
              [disabled]="settingsStore.isLoading()"
              class="form-select">
              <option value="strict">Strict (Minimal connections)</option>
              <option value="moderate">Moderate (Required connections only)</option>
              <option value="open">Open (All connections allowed)</option>
            </select>
          </rag-form-field>

          <rag-form-field label="Connection Options">
            <rag-checkbox formControlName="allowOutboundConnections">
              Allow outbound connections for updates
            </rag-checkbox>
          </rag-form-field>
        }
      </div>

      @if (settingsForm.value.airGappedMode) {
        <rag-alert variant="warning" [icon]="'alert-triangle'">
          Air-gapped mode will be enabled after application restart. All network connections will be blocked.
        </rag-alert>
      }
    </rag-settings-section>

    <!-- Data Protection Section -->
    <rag-settings-section
      title="Data Protection"
      description="Configure encryption and data security settings"
      [icon]="LockIcon">

      <div class="encryption-status" slot="header-actions">
        Encryption: {{ encryptionStatus() }}
      </div>

      <div class="form-grid">
        <rag-form-field label="Data Encryption">
          <rag-checkbox formControlName="encryptData">
            Encrypt data at rest (recommended)
          </rag-checkbox>
        </rag-form-field>

        @if (settingsForm.value.encryptData) {
          <rag-form-field label="Encryption Strength">
            <select
              formControlName="encryptionStrength"
              [disabled]="settingsStore.isLoading()"
              class="form-select">
              <option value="aes-128">AES-128 (Standard)</option>
              <option value="aes-256">AES-256 (High Security)</option>
              <option value="chacha20">ChaCha20-Poly1305 (Modern)</option>
            </select>
          </rag-form-field>
        }
      </div>

      @if (settingsForm.value.encryptData && !isEncryptionEnabled()) {
        <rag-alert variant="info" [icon]="'info'">
          Encryption will be applied to new data. Existing data will be encrypted during the next backup.
        </rag-alert>
      }
    </rag-settings-section>

    <!-- Audit & Compliance Section -->
    <rag-settings-section
      title="Audit & Compliance"
      description="Configure logging, auditing, and compliance settings"
      [icon]="FileTextIcon">

      <div class="audit-status" slot="header-actions">
        Audit: {{ auditStatus() }}
      </div>

      <div class="form-grid">
        <rag-form-field label="Audit Logging">
          <rag-checkbox formControlName="auditLogging">
            Enable comprehensive audit logging
          </rag-checkbox>
        </rag-form-field>

        <rag-form-field label="Log Retention (days)">
          <input
            type="number"
            formControlName="logRetention"
            [disabled]="settingsStore.isLoading()"
            min="7"
            max="365"
            class="form-input" />
        </rag-form-field>

        <rag-form-field label="Privacy Options">
          <rag-checkbox formControlName="logRedaction">
            Enable log redaction (remove sensitive data)
          </rag-checkbox>
        </rag-form-field>
      </div>
    </rag-settings-section>

    <!-- Citation & Permission Section -->
    <rag-settings-section
      title="Citations & Permissions"
      description="Configure citation policies and permission levels"
      [icon]="EyeIcon">

      <div class="form-grid">
        <rag-form-field label="Citation Policy">
          <rag-checkbox formControlName="citationPolicy">
            Enforce strict citation policy
          </rag-checkbox>
        </rag-form-field>

        <rag-form-field label="Response Requirements">
          <rag-checkbox formControlName="requireCitations">
            Require citations for all responses ("no citation â†’ no answer")
          </rag-checkbox>
        </rag-form-field>

        <rag-form-field label="Permission Level">
          <select
            formControlName="permissionLevel"
            [disabled]="settingsStore.isLoading()"
            class="form-select">
            <option value="basic">Basic (Read-only operations)</option>
            <option value="standard">Standard (Read-write operations)</option>
            <option value="admin">Admin (Full system access)</option>
          </select>
        </rag-form-field>
      </div>
    </rag-settings-section>

    <!-- Form Actions -->
    <div class="form-actions">
      <rag-button
        type="button"
        variant="outline"
        (click)="resetSettings()"
        [disabled]="settingsStore.isLoading()">
        Reset to Defaults
      </rag-button>

      <rag-button
        type="submit"
        variant="solid"
        [loading]="settingsStore.isLoading()"
        [disabled]="settingsForm.invalid">
        Save Security Settings
      </rag-button>
    </div>
  </form>
</div>