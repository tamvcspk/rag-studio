<div class="general-settings-panel">
  @if (settingsStore.error()) {
    <rag-alert variant="error" [icon]="'alert-circle'">
      {{ settingsStore.error() }}
    </rag-alert>
  }

  <form [formGroup]="settingsForm" (ngSubmit)="saveSettings()" class="settings-form">

    <!-- Workspace Settings Section -->
    <rag-settings-section
      title="Workspace Settings"
      description="Configure workspace name and data storage location"
      [icon]="FolderOpenIcon">

      <div class="form-grid">
        <rag-form-field label="Workspace Name">
          <input
            type="text"
            formControlName="workspaceName"
            [disabled]="settingsStore.isLoading()"
            placeholder="My RAG Studio Workspace"
            class="form-input" />
        </rag-form-field>

        <rag-form-field label="Data Directory">
          <div class="input-group">
            <input
              type="text"
              formControlName="dataDirectory"
              [disabled]="settingsStore.isLoading()"
              readonly
              class="form-input form-input-readonly" />
            <rag-button
              type="button"
              variant="outline"
              size="sm"
              (click)="selectDataDirectory()"
              [disabled]="settingsStore.isLoading()">
              Browse
            </rag-button>
          </div>
        </rag-form-field>
      </div>
    </rag-settings-section>

    <!-- Backup Settings Section -->
    <rag-settings-section
      title="Backup & Recovery"
      description="Configure automatic backup and data recovery options"
      [icon]="SettingsIcon">

      <div class="form-grid">
        <rag-form-field label="Auto-save Options">
          <rag-checkbox formControlName="autoSave">
            Enable auto-save (recommended)
          </rag-checkbox>
        </rag-form-field>

        <rag-form-field label="Backup Options">
          <rag-checkbox formControlName="autoBackup">
            Enable automatic backups
          </rag-checkbox>
        </rag-form-field>

        @if (settingsForm.value.autoBackup) {
          <rag-form-field label="Backup Interval">
            <select
              formControlName="backupInterval"
              [disabled]="settingsStore.isLoading()"
              class="form-select">
              <option value="daily">Daily</option>
              <option value="weekly">Weekly</option>
              <option value="monthly">Monthly</option>
            </select>
          </rag-form-field>

          <rag-form-field label="Max Backup Files">
            <input
              type="number"
              formControlName="maxBackups"
              [disabled]="settingsStore.isLoading()"
              min="1"
              max="50"
              class="form-input" />
          </rag-form-field>
        }
      </div>
    </rag-settings-section>

    <!-- Interface Settings Section -->
    <rag-settings-section
      title="Interface Settings"
      description="Customize the appearance and language of the application"
      [icon]="PaletteIcon">

      <div class="form-grid">
        <rag-form-field label="Theme">
          <select
            formControlName="theme"
            [disabled]="settingsStore.isLoading()"
            class="form-select">
            <option value="system">Follow System</option>
            <option value="light">Light</option>
            <option value="dark">Dark</option>
          </select>
        </rag-form-field>

        <rag-form-field label="Language">
          <select
            formControlName="language"
            [disabled]="settingsStore.isLoading()"
            class="form-select">
            <option value="en">English</option>
            <option value="es">Español</option>
            <option value="fr">Français</option>
            <option value="de">Deutsch</option>
          </select>
        </rag-form-field>

        <rag-form-field label="Log Level">
          <select
            formControlName="logLevel"
            [disabled]="settingsStore.isLoading()"
            class="form-select">
            <option value="error">Error Only</option>
            <option value="warn">Warnings</option>
            <option value="info">Information</option>
            <option value="debug">Debug</option>
          </select>
        </rag-form-field>
      </div>
    </rag-settings-section>

    <!-- Form Actions -->
    <div class="form-actions">
      <rag-button
        type="button"
        variant="outline"
        (click)="resetSettings()"
        [disabled]="settingsStore.isLoading()">
        Reset to Defaults
      </rag-button>

      <rag-button
        type="submit"
        variant="solid"
        [loading]="settingsStore.isLoading()"
        [disabled]="settingsForm.invalid">
        Save General Settings
      </rag-button>
    </div>
  </form>
</div>