<div class="general-settings-panel">
  @if (settingsStore.error()) {
    <rag-alert variant="error">
      {{ settingsStore.error() }}
    </rag-alert>
  }

  <form [formGroup]="settingsForm" (ngSubmit)="saveSettings()" class="settings-form">

    <!-- Workspace Settings Section -->
    <rag-settings-section
      title="Workspace Settings"
      description="Configure workspace name and data storage location"
      [icon]="FolderOpenIcon">

      <div class="form-grid">
        <rag-form-field label="Workspace Name">
          <rag-input
            type="text"
            formControlName="workspaceName"
            placeholder="My RAG Studio Workspace" />
        </rag-form-field>

        <rag-form-field label="Data Directory">
          <rag-input
            type="path"
            formControlName="dataDirectory"
            [browseMode]="'folder'"
            [browseTitle]="'Select Data Directory'"
            [placeholder]="'Choose data directory...'"
            (onBrowse)="selectDataDirectory()" />
        </rag-form-field>
      </div>
    </rag-settings-section>

    <!-- Backup Settings Section -->
    <rag-settings-section
      title="Backup & Recovery"
      description="Configure automatic backup and data recovery options"
      [icon]="SettingsIcon">

      <div class="form-grid">
        <rag-form-field label="Auto-save Options">
          <rag-checkbox formControlName="autoSave">
            Enable auto-save (recommended)
          </rag-checkbox>
        </rag-form-field>

        <rag-form-field label="Backup Options">
          <rag-checkbox formControlName="autoBackup">
            Enable automatic backups
          </rag-checkbox>
        </rag-form-field>

        @if (settingsForm.value.autoBackup) {
          <rag-form-field label="Backup Interval">
            <rag-select
              formControlName="backupInterval"
              [options]="backupIntervalOptions" />
          </rag-form-field>

          <rag-form-field label="Max Backup Files">
            <rag-number-input
              formControlName="maxBackups"
              [min]="1"
              [max]="50"
              [showButtons]="true"
              suffix="files" />
          </rag-form-field>
        }
      </div>
    </rag-settings-section>

    <!-- Interface Settings Section -->
    <rag-settings-section
      title="Interface Settings"
      description="Customize the appearance and language of the application"
      [icon]="PaletteIcon">

      <div class="form-grid">
        <rag-form-field label="Theme">
          <rag-select
            formControlName="theme"
            [options]="themeOptions" />
        </rag-form-field>

        <rag-form-field label="Language">
          <rag-select
            formControlName="language"
            [options]="languageOptions" />
        </rag-form-field>

        <rag-form-field label="Log Level">
          <rag-select
            formControlName="logLevel"
            [options]="logLevelOptions" />
        </rag-form-field>
      </div>
    </rag-settings-section>

    <!-- Server Settings Section -->
    <rag-settings-section
      title="Server Settings"
      description="Configure MCP server and connection settings"
      [icon]="ServerIcon">

      <div class="server-status" slot="header-actions">
        Status: {{ serverStatus() }}
      </div>

      <div class="form-grid">
        <rag-form-field label="Enable MCP Server">
          <rag-checkbox formControlName="mcpServerEnabled">
            Start server automatically
          </rag-checkbox>
        </rag-form-field>

        <rag-form-field label="Server Port">
          <rag-number-input
            formControlName="mcpServerPort"
            [min]="1024"
            [max]="65535"
            [showButtons]="true"
            [useGrouping]="false" />
        </rag-form-field>

        <rag-form-field label="Max Connections">
          <rag-number-input
            formControlName="maxConnections"
            [min]="1"
            [max]="1000"
            [showButtons]="true"
            suffix="conn" />
        </rag-form-field>
      </div>

      <div class="section-actions">
        @if (isServerRunning()) {
          <rag-button
            variant="outline"
            color="red"
            [loading]="settingsStore.isLoading()"
            (click)="stopServer()">
            Stop Server
          </rag-button>
        } @else {
          <rag-button
            variant="solid"
            color="green"
            [loading]="settingsStore.isLoading()"
            (click)="startServer()">
            Start Server
          </rag-button>
        }
      </div>
    </rag-settings-section>

    <!-- Knowledge Base Settings Section -->
    <rag-settings-section
      title="Knowledge Base Settings"
      description="Configure embedding models, chunk size, and search parameters"
      [icon]="DatabaseIcon">

      <div class="form-grid">
        <rag-form-field label="Chunk Size (tokens)">
          <rag-number-input
            formControlName="chunkSize"
            [min]="128"
            [max]="2048"
            [step]="64"
            [showButtons]="true"
            suffix="tokens" />
        </rag-form-field>

        <rag-form-field label="Search Top-K Results">
          <rag-number-input
            formControlName="searchTopK"
            [min]="1"
            [max]="50"
            [showButtons]="true"
            suffix="results" />
        </rag-form-field>

        <rag-form-field label="Search Options">
          <rag-checkbox formControlName="enableHybridSearch">
            Enable hybrid search (Vector + BM25)
          </rag-checkbox>
        </rag-form-field>
      </div>
    </rag-settings-section>

    <!-- Form Actions -->
    <div class="form-actions">
      <rag-button
        type="button"
        variant="outline"
        (click)="resetSettings()"
        [disabled]="settingsStore.isLoading()">
        Reset to Defaults
      </rag-button>

      <rag-button
        type="submit"
        variant="solid"
        [loading]="settingsStore.isLoading()"
        [disabled]="settingsForm.invalid">
        Save General Settings
      </rag-button>
    </div>
  </form>
</div>