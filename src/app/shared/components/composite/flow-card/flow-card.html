<rag-card>
  <div class="flow-card">
    <div class="flow-card-header">
      <div class="flow-info">
        <div class="flow-icon">
          <rag-icon [img]="gitBranchIcon" [size]="20"></rag-icon>
        </div>
        <div class="flow-details">
          <h3 class="flow-title">{{ flow().name }}</h3>
          <p class="flow-description">{{ flow().description }}</p>
        </div>
      </div>
      <div class="flow-status">
        <rag-chip 
          [variant]="'solid'" 
          [color]="getStatusColor()"
          class="status-chip">
          <rag-icon [img]="getStatusIcon()" [size]="12"></rag-icon>
          <span>{{ flow().status | titlecase }}</span>
        </rag-chip>
      </div>
    </div>

    <div class="flow-parts-preview">
      <div class="parts-flow">
        @for (part of flow().parts; track part.id; let isLast = $last) {
          <div class="flow-part">
            <rag-chip [variant]="'soft'">{{ part.kind }}</rag-chip>
            <span class="part-name">{{ part.name }}</span>
          </div>
          @if (!isLast) {
            <rag-icon 
              [img]="arrowRightIcon" 
              [size]="16" 
              class="flow-arrow">
            </rag-icon>
          }
        }
      </div>
    </div>

    @if (flow().tags.length > 0) {
      <div class="flow-tags">
        @for (tag of flow().tags; track tag) {
          <rag-chip [variant]="'outline'" size="sm">{{ tag }}</rag-chip>
        }
      </div>
    }

    <div class="flow-stats">
      <div class="stat-item">
        <span class="stat-label">Executions</span>
        <span class="stat-value">{{ flow().executionCount }}</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Success Rate</span>
        <span class="stat-value">{{ flow().successRate | percent }}</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Avg Duration</span>
        <span class="stat-value">{{ formatDuration(flow().avgExecutionTime) }}</span>
      </div>
      @if (flow().lastExecutedAt) {
        <div class="stat-item">
          <span class="stat-label">Last Run</span>
          <span class="stat-value">{{ flow().lastExecutedAt | date:'short' }}</span>
        </div>
      }
    </div>

    <div class="flow-actions">
      <div class="primary-actions">
        @switch (flow().status) {
          @case ('active') {
            <rag-button 
              [variant]="'outline'" 
              [size]="'sm'"
              (click)="onPauseClick()">
              <rag-icon [img]="pauseIcon" [size]="14"></rag-icon>
              Pause
            </rag-button>
          }
          @case ('paused') {
            <rag-button 
              [variant]="'outline'" 
              [size]="'sm'"
              (click)="onResumeClick()">
              <rag-icon [img]="playIcon" [size]="14"></rag-icon>
              Resume
            </rag-button>
          }
          @default {
            <rag-button 
              [variant]="'outline'" 
              [size]="'sm'"
              (click)="onExecuteClick()">
              <rag-icon [img]="playIcon" [size]="14"></rag-icon>
              Execute
            </rag-button>
          }
        }
        
        <rag-button 
          [variant]="'ghost'" 
          [size]="'sm'"
          (click)="onEditClick()">
          <rag-icon [img]="editIcon" [size]="14"></rag-icon>
          Edit
        </rag-button>
      </div>
      
      <div class="secondary-actions">
        <rag-button 
          [variant]="'ghost'" 
          [size]="'sm'"
          (click)="onDuplicateClick()">
          <rag-icon [img]="copyIcon" [size]="14"></rag-icon>
          Duplicate
        </rag-button>
        
        <rag-button 
          [variant]="'ghost'" 
          [size]="'sm'"
          (click)="onExportClick()">
          <rag-icon [img]="downloadIcon" [size]="14"></rag-icon>
          Export
        </rag-button>
        
        <rag-button 
          [variant]="'ghost'" 
          [size]="'sm'"
          class="delete-button"
          (click)="onDeleteClick()">
          <rag-icon [img]="trash2Icon" [size]="14"></rag-icon>
          Delete
        </rag-button>
      </div>
    </div>
  </div>
</rag-card>
