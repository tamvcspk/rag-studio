<div class="create-flow-wizard">
  <!-- Header -->
  <div class="wizard-header">
    <div class="wizard-title">
      <lucide-angular [name]="'git-branch'" [size]="24"></lucide-angular>
      <h2>Create New Flow</h2>
    </div>
    <div class="wizard-progress">
      <rag-progress [value]="progress" [max]="100"></rag-progress>
      <span class="progress-text">Step {{ currentStep() + 1 }} of {{ steps.length }}</span>
    </div>
  </div>

  <!-- Step Navigation -->
  <div class="step-navigation">
    @for (step of steps; track step.id; let i = $index) {
      <div 
        class="step-item"
        [class.active]="i === currentStep()"
        [class.completed]="step.completed"
        (click)="goToStep(i)">
        <div class="step-icon">
          @if (step.completed) {
            <lucide-angular [name]="'check'" [size]="16"></lucide-angular>
          } @else {
            <span>{{ i + 1 }}</span>
          }
        </div>
        <div class="step-info">
          <div class="step-title">{{ step.title }}</div>
          <div class="step-description">{{ step.description }}</div>
        </div>
      </div>
    }
  </div>

  <!-- Step Content -->
  <div class="step-content">
    @switch (currentStep()) {
      <!-- Step 1: Basic Information -->
      @case (0) {
        <div class="basic-info-step">
          <h3>Basic Information</h3>
          <p class="step-intro">Let's start with the basic details of your flow.</p>

          <div class="form-group">
            <label>Flow Name</label>
            <rag-input
              [(ngModel)]="flowName"
              placeholder="Enter a descriptive name for your flow">
            </rag-input>
          </div>

          <div class="form-group">
            <label>Description</label>
            <rag-textarea
              [(ngModel)]="flowDescription"
              placeholder="Describe what this flow does and its purpose"
[rows]="3">
            </rag-textarea>
          </div>

          <div class="form-group">
            <label>Tags</label>
            <div class="tag-input">
              <rag-input
                [(ngModel)]="tagInput"
                placeholder="Add a tag and press Enter"
                (keyup.enter)="addTag()">
              </rag-input>
              <rag-button 
                [variant]="'outline'" 
                [size]="'sm'"
                (click)="addTag()"
                [disabled]="!newTag().trim()">
                Add
              </rag-button>
            </div>
            <div class="tags-list" *ngIf="formData().tags.length > 0">
              @for (tag of formData().tags; track tag) {
                <rag-badge [variant]="'soft'" class="tag-item">
                  {{ tag }}
                  <button class="remove-tag" (click)="removeTag(tag)">
                    <lucide-angular [name]="'x'" [size]="12"></lucide-angular>
                  </button>
                </rag-badge>
              }
            </div>
          </div>
        </div>
      }

      <!-- Step 2: Add Components -->
      @case (1) {
        <div class="components-step">
          <h3>Add Components</h3>
          <p class="step-intro">Select the tools, knowledge bases, and pipelines for your flow.</p>

          <div class="components-grid">
            @for (component of availableComponents; track component.id) {
              <div 
                class="component-card"
                [class.selected]="isComponentSelected(component)"
                (click)="toggleComponent(component)">
                <div class="component-header">
                  <div class="component-icon">
                    <lucide-angular [name]="getComponentIcon(component.type)" [size]="20"></lucide-angular>
                  </div>
                  <div class="component-info">
                    <div class="component-name">{{ component.name }}</div>
                    <div class="component-type">{{ component.type | titlecase }}</div>
                  </div>
                  <div class="selection-indicator">
                    @if (isComponentSelected(component)) {
                      <lucide-angular [name]="'check-circle'" [size]="20" class="selected-icon"></lucide-angular>
                    } @else {
                      <lucide-angular [name]="'plus-circle'" [size]="20" class="add-icon"></lucide-angular>
                    }
                  </div>
                </div>
                <div class="component-description" *ngIf="component.description">
                  {{ component.description }}
                </div>
              </div>
            }
          </div>

          <div class="selected-summary" *ngIf="selectedComponents().length > 0">
            <h4>Selected Components ({{ selectedComponents().length }})</h4>
            <div class="selected-list">
              @for (component of selectedComponents(); track component.id) {
                <rag-badge [variant]="'outline'">
                  <lucide-angular [name]="getComponentIcon(component.type)" [size]="12"></lucide-angular>
                  {{ component.name }}
                </rag-badge>
              }
            </div>
          </div>
        </div>
      }

      <!-- Step 3: Connect Components -->
      @case (2) {
        <div class="connections-step">
          <h3>Connect Components</h3>
          <p class="step-intro">Define how your components work together (optional for now).</p>

          <div class="flow-preview">
            <div class="flow-visualization">
              @for (component of selectedComponents(); track component.id; let isLast = $last) {
                <div class="flow-node">
                  <div class="node-icon">
                    <lucide-angular [name]="getComponentIcon(component.type)" [size]="16"></lucide-angular>
                  </div>
                  <div class="node-label">{{ component.name }}</div>
                </div>
                @if (!isLast) {
                  <div class="flow-connector">
                    <lucide-angular [name]="'arrow-right'" [size]="20"></lucide-angular>
                  </div>
                }
              }
            </div>
          </div>

          <div class="connection-note">
            <lucide-angular [name]="'info'" [size]="16"></lucide-angular>
            <div>
              <strong>Note:</strong> Advanced connection configuration will be available in the flow designer. 
              For now, components will be connected in the order selected.
            </div>
          </div>
        </div>
      }

      <!-- Step 4: Review & Create -->
      @case (3) {
        <div class="review-step">
          <h3>Review & Create</h3>
          <p class="step-intro">Review your flow configuration before creating.</p>

          <rag-card class="review-card">
            <div class="review-section">
              <h4>Basic Information</h4>
              <div class="review-item">
                <span class="label">Name:</span>
                <span class="value">{{ formData().name }}</span>
              </div>
              <div class="review-item">
                <span class="label">Description:</span>
                <span class="value">{{ formData().description }}</span>
              </div>
              <div class="review-item" *ngIf="formData().tags.length > 0">
                <span class="label">Tags:</span>
                <div class="tags-list">
                  @for (tag of formData().tags; track tag) {
                    <rag-badge [variant]="'soft'">{{ tag }}</rag-badge>
                  }
                </div>
              </div>
            </div>

            <div class="review-section">
              <h4>Components ({{ selectedComponents().length }})</h4>
              @for (component of selectedComponents(); track component.id; let i = $index) {
                <div class="component-review-item">
                  <div class="component-order">{{ i + 1 }}</div>
                  <div class="component-icon">
                    <lucide-angular [name]="getComponentIcon(component.type)" [size]="16"></lucide-angular>
                  </div>
                  <div class="component-details">
                    <div class="component-name">{{ component.name }}</div>
                    <div class="component-type">{{ component.type | titlecase }}</div>
                  </div>
                </div>
              }
            </div>
          </rag-card>
        </div>
      }
    }
  </div>

  <!-- Actions -->
  <div class="wizard-actions">
    <div class="secondary-actions">
      <rag-button 
        [variant]="'ghost'" 
        (click)="cancel()">
        Cancel
      </rag-button>
      
      @if (canGoPrevious) {
        <rag-button 
          [variant]="'outline'" 
          (click)="previousStep()">
          <lucide-angular [name]="'arrow-left'" [size]="14"></lucide-angular>
          Previous
        </rag-button>
      }
    </div>

    <div class="primary-actions">
      @if (currentStep() < steps.length - 1) {
        <rag-button 
          [variant]="'solid'" 
          [disabled]="!canGoNext"
          (click)="nextStep()">
          Next
          <lucide-angular [name]="'arrow-right'" [size]="14"></lucide-angular>
        </rag-button>
      } @else {
        <rag-button 
          [variant]="'solid'" 
          [disabled]="isCreating()"
          (click)="createFlow()">
          @if (isCreating()) {
            Creating Flow...
          } @else {
            Create Flow
          }
          <lucide-angular [name]="'check'" [size]="14"></lucide-angular>
        </rag-button>
      }
    </div>
  </div>
</div>
