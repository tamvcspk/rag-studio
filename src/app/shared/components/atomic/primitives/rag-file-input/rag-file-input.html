<div [class]="containerClasses()">
  <!-- Error Alert -->
  @if (showError()) {
    <rag-alert
      variant="error"
      [closable]="true"
      (onClose)="dismissError()"
      class="file-input-error">
      {{ errorMessage() }}
    </rag-alert>
  }

  <!-- Hidden file input -->
  <input
    #fileInput
    type="file"
    [accept]="accept()"
    [multiple]="multiple()"
    [disabled]="disabled()"
    (change)="onFileInputChange($event)"
    class="file-input-hidden" />

  <!-- Drop zone / main input area -->
  <div
    class="file-input-zone"
    [class.drag-drop-enabled]="dragDrop() && !disabled()"
    (click)="triggerFileSelect()"
    (dragover)="onDragOver($event)"
    (dragleave)="onDragLeave($event)"
    (drop)="onDrop($event)">

    <div class="file-input-content">
      @if (!hasFiles()) {
        <!-- Empty state -->
        <div class="file-input-empty">
          <rag-icon [img]="UploadIcon" class="upload-icon" />
          <div class="file-input-text">
            <span class="placeholder">{{ placeholderText() }}</span>
            @if (dragDrop() && !disabled()) {
              <span class="drag-hint">or drag and drop files here</span>
            }
          </div>
        </div>
      } @else {
        <!-- Files selected state -->
        <div class="file-input-selected">
          <rag-icon [img]="FileIcon" class="file-icon" />
          <span class="file-summary">{{ placeholderText() }}</span>
          @if (clearable() && !disabled()) {
            <button
              type="button"
              class="clear-button"
              (click)="clearFiles(); $event.stopPropagation()"
              [disabled]="disabled()">
              <rag-icon [img]="XIcon" size="sm" />
            </button>
          }
        </div>
      }
    </div>
  </div>

  <!-- File list -->
  @if (showFileList() && hasFiles()) {
    <div class="file-list">
      @for (file of files(); track file.name + file.size) {
        <div class="file-item">
          <div class="file-info">
            <rag-icon [img]="FileIcon" size="sm" class="file-item-icon" />
            <div class="file-details">
              <span class="file-name">{{ file.name }}</span>
              <span class="file-size">{{ formatFileSize(file.size) }}</span>
            </div>
          </div>
          @if (!disabled()) {
            <button
              type="button"
              class="remove-file-button"
              (click)="removeFile(file)"
              [disabled]="disabled()">
              <rag-icon [img]="XIcon" size="xs" />
            </button>
          }
        </div>
      }
    </div>
  }
</div>